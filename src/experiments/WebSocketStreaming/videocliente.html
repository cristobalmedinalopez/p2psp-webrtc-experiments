<!DOCTYPE html>
<html>
  <head>
		<title>Websocket Demo</title>
		
		<script>
			var video;
			var mediaSource = new MediaSource();			
			function doInit() {
				video = document.getElementById("player");
				window.MediaSource = window.MediaSource || window.WebKitMediaSource;
				if (!!!window.MediaSource) {
				  alert('MediaSource API is not available');
				}

				
				video.src = window.URL.createObjectURL(mediaSource);

				mediaSource.addEventListener('sourceopen', callback, false);
				mediaSource.addEventListener('webkitsourceopen', callback, false);

				mediaSource.addEventListener('webkitsourceended', function(e) {
				  logger.log('mediaSource readyState: ' + this.readyState);
				}, false);
		 		
		
			}

function callback(e) {
			  
                          var sourceBuffer = mediaSource.addSourceBuffer('video/webm; codecs="vorbis,vp8"');

			  console.log('mediaSource readyState: ' + this.readyState);
			  
				var s;
				try {
					var host = "ws://127.0.0.1:9876/";
				        				
					s = new WebSocket(host);
					var canvas = document.getElementById('output');
					var ctx = canvas.getContext('2d');
					s.onopen = function (e) { console.log("connected..."); };
					s.onclose = function (e) { console.log("connection closed."); };
					s.onerror = function (e) { console.log("connection error."); };
					s.onmessage = function (e) { 
					        var hex = e.data, // ASCII HEX: 37="7", 57="W", 71="q"
						    bytes = [],
						    str;

						for(var i=0; i< hex.length-1; i+=2){
						    bytes.push(parseInt(hex.substr(i, 2), 16));
						}

						str = String.fromCharCode.apply(String, bytes);						
						sourceBuffer.appendBuffer(str);
						console.log(str);
				        };
				} catch (ex) {
					console.log("connection exception:" + ex);
				}
				
			}
		</script>		
	</head>
<body onload="doInit()">
	<video id="player" autoplay> </video>
	<canvas width="640" height="480" id="output"></canvas>
</body>
</html>
